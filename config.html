<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Everytag Configuration</title>
    <link rel="stylesheet" href="config.css">
</head>
<body>
    <div class="container">
        <h1>üè∑Ô∏è Everytag Configuration <span class="connected-indicator" id="connectionIndicator"></span></h1>
        <p class="subtitle">Configure your Everytag beacon via Bluetooth</p>

        <div id="statusMessage" class="status"></div>

        <button id="connectBtn" onclick="connectDevice()">Connect to Everytag</button>

        <div id="configForm" style="display: none; margin-top: 30px;">
            <div class="form-group">
                <label for="authCode">Authorization Code (required)</label>
                <input type="password" id="authCode" placeholder="Default: abcdefgh" value="abcdefgh">
                <p class="info-text">Required to authenticate with the beacon</p>
            </div>

            <hr>

            <h3 style="margin-bottom: 20px; color: #333;">Broadcasting Settings</h3>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="enableFmdn" checked>
                    <label for="enableFmdn" style="margin: 0;">Enable Google FMDN Broadcast</label>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="enableAirtag" checked>
                    <label for="enableAirtag" style="margin: 0;">Enable AirTag Broadcast</label>
                </div>
            </div>

            <div class="form-group">
                <label for="broadcastDelay">Broadcast Switching Delay (seconds)</label>
                <select id="broadcastDelay">
                    <option value="1">1 second</option>
                    <option value="2" selected>2 seconds</option>
                    <option value="4">4 seconds</option>
                    <option value="8">8 seconds</option>
                </select>
            </div>

            <div class="form-group">
                <label for="txPower">TX Power Level</label>
                <select id="txPower">
                    <option value="0">Low (-8 dBm)</option>
                    <option value="1" selected>Normal (0 dBm)</option>
                    <option value="2">High (+4/+8 dBm)</option>
                </select>
            </div>

            <hr>

            <h3 style="margin-bottom: 20px; color: #333;">AirTag Keys</h3>

            <div class="form-group">
                <label for="keyFile">Upload AirTag Key File</label>
                <div class="file-input-wrapper">
                    <div class="file-input-label" id="keyFileLabel">Click to select keyfile</div>
                    <input type="file" id="keyFile" accept="*" onchange="handleKeyFileSelect(this)">
                </div>
                <p class="file-name" id="keyFileName"></p>
                <p class="info-text">Binary keyfile from generate_keys.py (*_keyfile)</p>
            </div>

            <div class="form-group">
                <label for="keyChangeInterval">Key Change Interval (seconds)</label>
                <input type="number" id="keyChangeInterval" placeholder="600" value="600" min="1">
            </div>

            <hr>

            <h3 style="margin-bottom: 20px; color: #333;">FMDN Settings</h3>

            <div class="form-group">
                <label for="fmdnKey">Google FMDN Key (20 bytes hex)</label>
                <input type="text" id="fmdnKey" placeholder="f1e101731f1e1b312272f812e521293a3f484414" maxlength="40">
                <p class="info-text">40 hex characters (20 bytes)</p>
            </div>

            <hr>

            <h3 style="margin-bottom: 20px; color: #333;">Advanced Settings</h3>

            <div class="form-group">
                <label for="newMacAddress">Settings Mode MAC Address</label>
                <input type="text" id="newMacAddress" placeholder="e7:93:3a:cc:f6:61">
                <p class="info-text">Set a specific MAC for settings mode (recommended after loading AirTag key)</p>
            </div>

            <div class="form-group">
                <label for="newAuthCode">New Authorization Code</label>
                <input type="password" id="newAuthCode" placeholder="Leave empty to keep current">
                <p class="info-text">Change the authentication password</p>
            </div>

            <div class="form-group">
                <label for="accelThreshold">Accelerometer Threshold</label>
                <input type="number" id="accelThreshold" placeholder="0 = disabled" min="0">
                <p class="info-text">Movement detection threshold (0 to disable)</p>
            </div>

            <div class="form-group">
                <label for="statusFlags">Status Byte Flags (hex)</label>
                <input type="text" id="statusFlags" placeholder="438000" value="438000">
                <p class="info-text">Advanced: Status byte behavior configuration</p>
            </div>

            <hr>

            <h3 style="margin-bottom: 20px; color: #333;">Time Synchronization</h3>

            <div class="button-group">
                <button class="secondary" onclick="readTime()">üìñ Read Time</button>
                <button class="secondary" onclick="writeTime()">‚è∞ Sync Time</button>
            </div>

            <div id="timeDisplay" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 8px; display: none;">
                <strong>Beacon Time:</strong> <span id="beaconTime"></span>
            </div>

            <hr>

            <button onclick="writeSettings()" style="margin-top: 20px;">üíæ Save All Settings</button>
            <button class="secondary" onclick="disconnectDevice()">Disconnect</button>
        </div>
    </div>

    <script src="config.js"></script>
</body>
</html>
